---
import Layout from '../../layouts/Layout.astro';
import ToggleGroup from '../../components/ToggleGroup.astro';
---

<Layout title="Simple Blur Fade Demo">
  <h1>Simple Blur Fade</h1>
  <p class="subtitle">Single-layer backdrop-filter blur with mask-image fade</p>

  <div class="demo-controls section-controls">
    <div class="control-row">
      <ToggleGroup
        label="100% blur until:"
        name="mask-end"
        options={[
          { label: '0%', value: '0' },
          { label: '15%', value: '15', checked: true },
          { label: '30%', value: '30' }
        ]}
      />
      <ToggleGroup
        label="Blur ends at:"
        name="mask-start"
        options={[
          { label: '30%', value: '30' },
          { label: '50%', value: '50', checked: true },
          { label: '70%', value: '70' }
        ]}
      />
      <label class="debug-toggle">
        <input type="checkbox" id="debug-lines" />
        <span>Debug</span>
      </label>
    </div>
  </div>

  <div class="aspect-ratio-section">
    <div class="aspect-ratio-grid">
      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:1</span>
        <div class="poster-card aspect-2-1">
          <img src="/posters/the-naked-city.png" alt="The Naked City" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>The Naked City</h3>
            <p>Jules Dassin • 1948</p>
            <p class="description">A documentary-style police procedural following the investigation of a young model's murder in New York City.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">16:9</span>
        <div class="poster-card aspect-16-9">
          <img src="/posters/once-upon-a-time-in-america.png" alt="Once Upon a Time in America" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>Once Upon a Time in America</h3>
            <p>Sergio Leone • 1984</p>
            <p class="description">A former Prohibition-era Jewish gangster returns to the Lower East Side of Manhattan and recalls his old life.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">4:3</span>
        <div class="poster-card aspect-4-3">
          <img src="/posters/the-landlord.png" alt="The Landlord" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>The Landlord</h3>
            <p>Hal Ashby • 1970</p>
            <p class="description">A wealthy young man buys a Brooklyn tenement with plans to evict the tenants, but becomes deeply involved in their lives instead.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:1</span>
        <div class="poster-card aspect-1-1">
          <img src="/posters/the-godfather-part-ii.png" alt="The Godfather Part II" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>The Godfather Part II</h3>
            <p>Francis Ford Coppola • 1974</p>
            <p class="description">The continuing saga of the Corleone crime family tells the parallel stories of Michael and his father Vito.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">3:4</span>
        <div class="poster-card aspect-3-4">
          <img src="/posters/west-side-story.png" alt="West Side Story" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>West Side Story</h3>
            <p>Robert Wise • 1961</p>
            <p class="description">Two youngsters from rival New York City gangs fall in love, but tensions between their respective friends build toward tragedy.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:3</span>
        <div class="poster-card aspect-2-3">
          <img src="/posters/mean-streets.png" alt="Mean Streets" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>Mean Streets</h3>
            <p>Martin Scorsese • 1973</p>
            <p class="description">A small-time hood struggles to reconcile his ambitions with his responsibilities to his neighborhood and his volatile friend.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">9:16</span>
        <div class="poster-card aspect-9-16">
          <img src="/posters/the-crowd.png" alt="The Crowd" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>The Crowd</h3>
            <p>King Vidor • 1928</p>
            <p class="description">A man and woman struggle to survive in the anonymity of the big city, facing tragedy and the challenge of ordinary life.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:2</span>
        <div class="poster-card aspect-1-2">
          <img src="/posters/a-raisin-in-the-sun.png" alt="A Raisin in the Sun" class="poster-image" />
          <div class="blur-layer"></div>
          <div class="debug-line debug-line-reach"></div>
          <div class="debug-line debug-line-full"></div>
          <div class="text-overlay">
            <h3>A Raisin in the Sun</h3>
            <p>Daniel Petrie • 1961</p>
            <p class="description">A Black family's struggle against racism and poverty as they consider accepting a buyout to stay out of a white neighborhood.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="info-section">
    <h2>How it works</h2>
    <p>This technique uses a single <code>backdrop-filter: blur()</code> layer with a <code>mask-image: linear-gradient()</code> to fade the blur to transparent. The blur intensity stays constant — only the opacity fades.</p>
    <pre><code>.blur-layer {'{'}
  backdrop-filter: blur(16px);
  mask-image: linear-gradient(
    to top,
    black 15%,       /* fully blurred at bottom */
    transparent 50%  /* no blur above 50% */
  );
{'}'}</code></pre>
    <p class="caveat"><strong>Limitation:</strong> The blur amount is uniform — you can't create a gradient where the blur gets progressively stronger.</p>
  </div>

  <!-- Text-Relative Blur Section -->
  <div class="text-relative-section">
    <h2>Text-Relative Blur Sizing</h2>
    <p class="section-intro">Instead of fixed percentages, blur boundaries are calculated from the text overlay's actual height. The blur automatically adapts when text content changes.</p>

    <div class="demo-controls text-relative-controls section-controls">
      <div class="control-row">
        <ToggleGroup
          label="100% blur until:"
          name="rel-full-mult"
          options={[
            { label: '0.25×', value: '0.25' },
            { label: '0.5×', value: '0.5' },
            { label: '0.8×', value: '0.8' },
            { label: '1.0×', value: '1', checked: true }
          ]}
        />
        <label class="debug-toggle">
          <input type="checkbox" id="rel-debug-lines" />
          <span>Debug</span>
        </label>
      </div>
      <div class="control-row">
        <ToggleGroup
          label="Blur ends at:"
          name="rel-sizing-mode"
          options={[
            { label: '× (Mult)', value: 'multiplier', checked: true },
            { label: 'em', value: 'em' }
          ]}
        />
        <span class="rel-controls-multiplier">
          <ToggleGroup
            label=""
            name="rel-end-mult"
            options={[
              { label: '0.75×', value: '0.75' },
              { label: '0.85×', value: '0.85' },
              { label: '0.9×', value: '0.9' },
              { label: '1.0×', value: '1' },
              { label: '1.1×', value: '1.1' },
              { label: '1.25×', value: '1.25', checked: true }
            ]}
          />
        </span>
        <span class="rel-controls-em" style="display: none;">
          <ToggleGroup
            label=""
            name="rel-end-em"
            options={[
              { label: '0.5em', value: '0.5' },
              { label: '0.75em', value: '0.75' },
              { label: '1em', value: '1', checked: true },
              { label: '1.1em', value: '1.1' },
              { label: '1.25em', value: '1.25' }
            ]}
          />
        </span>
      </div>
    </div>

    <div class="text-relative-grid">
      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:1 (ultra-wide)</span>
        <div class="poster-card text-relative-card aspect-2-1" data-aspect="2-1">
          <img src="/posters/taxi-driver.png" alt="Taxi Driver" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>Taxi Driver</h3>
            <p class="subtitle">Martin Scorsese • 1976</p>
            <p class="description">A mentally unstable veteran works as a nighttime taxi driver in New York City.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">16:9 (widescreen)</span>
        <div class="poster-card text-relative-card aspect-16-9" data-aspect="16-9">
          <img src="/posters/once-upon-a-time-in-america.png" alt="Once Upon a Time in America" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>Once Upon a Time in America</h3>
            <p class="subtitle">Sergio Leone • 1984</p>
            <p class="description">A former Prohibition-era Jewish gangster returns to the Lower East Side of Manhattan.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">4:3 (standard)</span>
        <div class="poster-card text-relative-card aspect-4-3" data-aspect="4-3">
          <img src="/posters/the-landlord.png" alt="The Landlord" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>The Landlord</h3>
            <p class="subtitle">Hal Ashby • 1970</p>
            <p class="description">A wealthy young man buys a Brooklyn tenement with plans to evict the tenants, but becomes deeply involved in their lives instead.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:1 (square)</span>
        <div class="poster-card text-relative-card aspect-1-1" data-aspect="1-1">
          <img src="/posters/the-godfather-part-ii.png" alt="The Godfather Part II" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>The Godfather Part II</h3>
            <p class="subtitle">Francis Ford Coppola • 1974</p>
            <p class="description">The continuing saga of the Corleone crime family tells the parallel stories of Michael and Vito.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">3:4 (portrait)</span>
        <div class="poster-card text-relative-card aspect-3-4" data-aspect="3-4">
          <img src="/posters/west-side-story.png" alt="West Side Story" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>West Side Story</h3>
            <p class="subtitle">Robert Wise, Jerome Robbins • 1961</p>
            <p class="description">Two youngsters from rival New York City gangs fall in love, but tensions between their respective friends build toward tragedy.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:3 (poster)</span>
        <div class="poster-card text-relative-card aspect-2-3" data-aspect="2-3">
          <img src="/posters/mean-streets.png" alt="Mean Streets" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>Mean Streets</h3>
            <p class="subtitle">Martin Scorsese • 1973</p>
            <p class="description">A small-time hood struggles to reconcile his ambitions with his responsibilities to his neighborhood and his volatile friend.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">9:16 (vertical)</span>
        <div class="poster-card text-relative-card aspect-9-16" data-aspect="9-16">
          <img src="/posters/the-crowd.png" alt="The Crowd" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>The Crowd</h3>
            <p class="subtitle">King Vidor • 1928</p>
            <p class="description">A man and woman struggle to survive in the anonymity of the big city.</p>
          </div>
        </div>
      </div>
      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:2 (tall banner)</span>
        <div class="poster-card text-relative-card aspect-1-2" data-aspect="1-2">
          <img src="/posters/a-raisin-in-the-sun.png" alt="A Raisin in the Sun" class="poster-image" />
          <div class="blur-layer rel-blur-layer"></div>
          <div class="debug-line rel-debug-line-text"></div>
          <div class="debug-line rel-debug-line-blur"></div>
          <div class="text-overlay rel-text-overlay">
            <h3>A Raisin in the Sun</h3>
            <p class="subtitle">Daniel Petrie • 1961</p>
            <p class="description">A Black family's struggle against racism and poverty as they consider accepting a buyout to stay out of a white neighborhood.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Comparison Slider Section -->
  <div class="comparison-section">
    <h2>Side-by-Side Comparison</h2>
    <p class="section-intro">Drag the slider to compare percentage-based (left) vs text-relative (right) blur sizing.</p>

    <div class="comparison-container">
      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:1 (ultra-wide)</span>
        <div class="comparison-card aspect-2-1">
          <img src="/posters/taxi-driver.png" alt="Taxi Driver" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/taxi-driver.png" alt="Taxi Driver" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>Taxi Driver</h3>
              <p class="subtitle">Martin Scorsese • 1976</p>
              <p class="description">A mentally unstable veteran works as a nighttime taxi driver.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/taxi-driver.png" alt="Taxi Driver" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>Taxi Driver</h3>
              <p class="subtitle">Martin Scorsese • 1976</p>
              <p class="description">A mentally unstable veteran works as a nighttime taxi driver.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">16:9 (widescreen)</span>
        <div class="comparison-card aspect-16-9">
          <img src="/posters/once-upon-a-time-in-america.png" alt="Once Upon a Time in America" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/once-upon-a-time-in-america.png" alt="Once Upon a Time in America" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>Once Upon a Time in America</h3>
              <p class="subtitle">Sergio Leone • 1984</p>
              <p class="description">A former gangster returns to the Lower East Side.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/once-upon-a-time-in-america.png" alt="Once Upon a Time in America" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>Once Upon a Time in America</h3>
              <p class="subtitle">Sergio Leone • 1984</p>
              <p class="description">A former gangster returns to the Lower East Side.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">4:3 (standard)</span>
        <div class="comparison-card aspect-4-3">
          <img src="/posters/the-landlord.png" alt="The Landlord" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/the-landlord.png" alt="The Landlord" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>The Landlord</h3>
              <p class="subtitle">Hal Ashby • 1970</p>
              <p class="description">A wealthy young man buys a Brooklyn tenement with plans to evict the tenants.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/the-landlord.png" alt="The Landlord" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>The Landlord</h3>
              <p class="subtitle">Hal Ashby • 1970</p>
              <p class="description">A wealthy young man buys a Brooklyn tenement with plans to evict the tenants.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:1 (square)</span>
        <div class="comparison-card aspect-1-1">
          <img src="/posters/the-godfather-part-ii.png" alt="The Godfather Part II" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/the-godfather-part-ii.png" alt="The Godfather Part II" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>The Godfather Part II</h3>
              <p class="subtitle">Francis Ford Coppola • 1974</p>
              <p class="description">The saga tells parallel stories of Michael and Vito.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/the-godfather-part-ii.png" alt="The Godfather Part II" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>The Godfather Part II</h3>
              <p class="subtitle">Francis Ford Coppola • 1974</p>
              <p class="description">The saga tells parallel stories of Michael and Vito.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">3:4 (portrait)</span>
        <div class="comparison-card aspect-3-4">
          <img src="/posters/west-side-story.png" alt="West Side Story" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/west-side-story.png" alt="West Side Story" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>West Side Story</h3>
              <p class="subtitle">Robert Wise, Jerome Robbins • 1961</p>
              <p class="description">A rivalry between Jets and Sharks gangs as Tony and Maria find love.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/west-side-story.png" alt="West Side Story" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>West Side Story</h3>
              <p class="subtitle">Robert Wise, Jerome Robbins • 1961</p>
              <p class="description">A rivalry between Jets and Sharks gangs as Tony and Maria find love.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">2:3 (poster)</span>
        <div class="comparison-card aspect-2-3">
          <img src="/posters/mean-streets.png" alt="Mean Streets" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/mean-streets.png" alt="Mean Streets" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>Mean Streets</h3>
              <p class="subtitle">Martin Scorsese • 1973</p>
              <p class="description">A small-time hood struggles to reconcile his ambitions.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/mean-streets.png" alt="Mean Streets" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>Mean Streets</h3>
              <p class="subtitle">Martin Scorsese • 1973</p>
              <p class="description">A small-time hood struggles to reconcile his ambitions.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">9:16 (vertical)</span>
        <div class="comparison-card aspect-9-16">
          <img src="/posters/the-crowd.png" alt="The Crowd" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/the-crowd.png" alt="The Crowd" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>The Crowd</h3>
              <p class="subtitle">King Vidor • 1928</p>
              <p class="description">Surviving in the anonymity of the big city.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/the-crowd.png" alt="The Crowd" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>The Crowd</h3>
              <p class="subtitle">King Vidor • 1928</p>
              <p class="description">Surviving in the anonymity of the big city.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>

      <div class="aspect-card-wrapper">
        <span class="aspect-label">1:2 (tall banner)</span>
        <div class="comparison-card aspect-1-2">
          <img src="/posters/a-raisin-in-the-sun.png" alt="A Raisin in the Sun" class="poster-image" />
          <div class="comparison-side comparison-left">
            <img src="/posters/a-raisin-in-the-sun.png" alt="A Raisin in the Sun" class="comparison-image" />
            <div class="blur-layer comparison-blur-left"></div>
            <div class="debug-line comparison-debug-left-full"></div>
            <div class="debug-line comparison-debug-left-end"></div>
            <div class="text-overlay comparison-text-left">
              <h3>A Raisin in the Sun</h3>
              <p class="subtitle">Daniel Petrie • 1961</p>
              <p class="description">A windfall gives hope to the Youngers, a Black family on Chicago's South Side.</p>
            </div>
            <span class="comparison-label">Percent</span>
          </div>
          <div class="comparison-side comparison-right">
            <img src="/posters/a-raisin-in-the-sun.png" alt="A Raisin in the Sun" class="comparison-image" />
            <div class="blur-layer comparison-blur-right"></div>
            <div class="debug-line comparison-debug-right-text"></div>
            <div class="debug-line comparison-debug-right-blur"></div>
            <div class="text-overlay comparison-text-right">
              <h3>A Raisin in the Sun</h3>
              <p class="subtitle">Daniel Petrie • 1961</p>
              <p class="description">A windfall gives hope to the Youngers, a Black family on Chicago's South Side.</p>
            </div>
            <span class="comparison-label">Text-Relative</span>
          </div>
          <div class="comparison-slider">
            <div class="slider-handle"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Global Controls -->
  <div class="floating-controls">
    <ToggleGroup
      label="Direction:"
      name="global-direction"
      options={[
        { label: 'Bottom', value: 'bottom', checked: true },
        { label: 'Top', value: 'top' },
        { label: 'Left', value: 'left' },
        { label: 'Right', value: 'right' }
      ]}
    />
    <ToggleGroup
      label="Radius (px):"
      name="global-blur"
      options={[
        { label: '8', value: '8' },
        { label: '16', value: '16', checked: true },
        { label: '24', value: '24' },
        { label: '32', value: '32' }
      ]}
    />
    <ToggleGroup
      label="Text:"
      name="global-text"
      options={[
        { label: 'Title', value: 'title' },
        { label: '+ Sub', value: 'subtitle' },
        { label: '+ Desc', value: 'full', checked: true }
      ]}
    />
    <label class="debug-toggle">
      <input type="checkbox" id="global-text-shadow" />
      <span>Text Shadow</span>
    </label>
    <label class="debug-toggle">
      <input type="checkbox" id="global-card-shadow" />
      <span>Card Shadow</span>
    </label>
  </div>
</Layout>

<script>
  // Select only the main section's blur layers (exclude text-relative and comparison sections)
  const blurLayers = document.querySelectorAll('.aspect-ratio-grid .blur-layer') as NodeListOf<HTMLElement>;
  const textOverlays = document.querySelectorAll('.aspect-ratio-grid .text-overlay') as NodeListOf<HTMLElement>;
  const debugLinesReach = document.querySelectorAll('.aspect-ratio-grid .debug-line-reach') as NodeListOf<HTMLElement>;
  const debugLinesFull = document.querySelectorAll('.aspect-ratio-grid .debug-line-full') as NodeListOf<HTMLElement>;
  const debugToggle = document.getElementById('debug-lines') as HTMLInputElement;

  // Global controls (floating bar)
  const globalTextShadowToggle = document.getElementById('global-text-shadow') as HTMLInputElement;
  const globalCardShadowToggle = document.getElementById('global-card-shadow') as HTMLInputElement;

  // Read initial values from URL params
  const params = new URLSearchParams(window.location.search);

  let blurAmount = parseInt(params.get('blur') || '16');
  let blurEnd = parseInt(params.get('end') || '50');      // where blur fades to 0
  let fullBlur = parseInt(params.get('full') || '15');    // where blur is 100%
  let direction = params.get('dir') || 'bottom';
  let debugEnabled = params.get('debug') === '1';
  let textShadowEnabled = params.get('textshadow') === '1';
  let cardShadowEnabled = params.get('cardshadow') === '1';
  let textLevel = params.get('text') || 'full';

  function updateURL() {
    const newParams = new URLSearchParams();
    if (direction !== 'bottom') newParams.set('dir', direction);
    if (blurAmount !== 16) newParams.set('blur', String(blurAmount));
    if (blurEnd !== 50) newParams.set('end', String(blurEnd));
    if (fullBlur !== 15) newParams.set('full', String(fullBlur));
    if (debugEnabled) newParams.set('debug', '1');
    if (textShadowEnabled) newParams.set('textshadow', '1');
    if (cardShadowEnabled) newParams.set('cardshadow', '1');
    if (textLevel !== 'full') newParams.set('text', textLevel);

    const newURL = newParams.toString()
      ? `${window.location.pathname}?${newParams.toString()}`
      : window.location.pathname;
    window.history.replaceState({}, '', newURL);
  }

  function applyTextLevel() {
    document.body.classList.remove('text-title-only', 'text-with-subtitle');
    if (textLevel === 'title') {
      document.body.classList.add('text-title-only');
    } else if (textLevel === 'subtitle') {
      document.body.classList.add('text-with-subtitle');
    }
    // 'full' shows everything (no class needed)

    // Recalculate text-relative blur after text level change
    requestAnimationFrame(() => {
      if (typeof updateRelBlur === 'function') updateRelBlur();
      if (typeof updateComparisonBlur === 'function') updateComparisonBlur();
    });
  }

  // Set initial control states from URL
  function initControls() {
    // Global direction
    const dirRadio = document.querySelector(`input[name="global-direction"][value="${direction}"]`) as HTMLInputElement;
    if (dirRadio) dirRadio.checked = true;

    // Blur end (where blur fades to 0)
    const endRadio = document.querySelector(`input[name="mask-start"][value="${blurEnd}"]`) as HTMLInputElement;
    if (endRadio) endRadio.checked = true;

    // Full blur (where blur is 100%)
    const fullRadio = document.querySelector(`input[name="mask-end"][value="${fullBlur}"]`) as HTMLInputElement;
    if (fullRadio) fullRadio.checked = true;

    // Debug toggle
    if (debugToggle) {
      debugToggle.checked = debugEnabled;
      document.body.classList.toggle('show-debug', debugEnabled);
    }

    // Global blur amount
    const blurRadio = document.querySelector(`input[name="global-blur"][value="${blurAmount}"]`) as HTMLInputElement;
    if (blurRadio) blurRadio.checked = true;

    // Global text level
    const textRadio = document.querySelector(`input[name="global-text"][value="${textLevel}"]`) as HTMLInputElement;
    if (textRadio) textRadio.checked = true;
    applyTextLevel();

    // Global text shadow toggle
    if (globalTextShadowToggle) {
      globalTextShadowToggle.checked = textShadowEnabled;
      document.body.classList.toggle('no-text-shadow', !textShadowEnabled);
    }

    // Global card shadow toggle
    if (globalCardShadowToggle) {
      globalCardShadowToggle.checked = cardShadowEnabled;
      document.body.classList.toggle('no-card-shadow', !cardShadowEnabled);
    }
  }

  // Map direction to CSS gradient direction and text position
  const directionConfig: Record<string, { gradientDir: string; textPos: Record<string, string>; isHorizontal: boolean }> = {
    bottom: { gradientDir: 'to top', textPos: { bottom: '0', top: 'auto', left: '0', right: '0' }, isHorizontal: false },
    top: { gradientDir: 'to bottom', textPos: { top: '0', bottom: 'auto', left: '0', right: '0' }, isHorizontal: false },
    left: { gradientDir: 'to right', textPos: { left: '0', right: 'auto', top: '0', bottom: '0' }, isHorizontal: true },
    right: { gradientDir: 'to left', textPos: { right: '0', left: 'auto', top: '0', bottom: '0' }, isHorizontal: true }
  };

  function applyBlurToLayer(layer: HTMLElement, config: typeof directionConfig[string], fullBlurPct: number, blurEndPct: number) {
    layer.style.backdropFilter = `blur(${blurAmount}px)`;
    layer.style.webkitBackdropFilter = `blur(${blurAmount}px)`;
    // Gradient from edge: fully opaque (blurred) up to fullBlurPct, then fade to transparent at blurEndPct
    layer.style.maskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;
    layer.style.webkitMaskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;
  }

  function applyTextPosition(overlay: HTMLElement, config: typeof directionConfig[string]) {
    Object.assign(overlay.style, config.textPos);
    if (config.isHorizontal) {
      overlay.style.width = '50%';
      overlay.style.display = 'flex';
      overlay.style.flexDirection = 'column';
      overlay.style.justifyContent = 'flex-end';
    } else {
      overlay.style.width = '';
      overlay.style.display = '';
      overlay.style.flexDirection = '';
      overlay.style.justifyContent = '';
    }
  }

  function updateBlur() {
    const config = directionConfig[direction];

    // Update all blur layers and text overlays
    blurLayers.forEach(layer => applyBlurToLayer(layer, config, fullBlur, blurEnd));
    textOverlays.forEach(overlay => applyTextPosition(overlay, config));

    // Update debug lines - position from the blur edge
    debugLinesReach.forEach(line => {
      line.style.bottom = direction === 'bottom' ? `${blurEnd}%` : 'auto';
      line.style.top = direction === 'top' ? `${blurEnd}%` : 'auto';
    });
    debugLinesFull.forEach(line => {
      line.style.bottom = direction === 'bottom' ? `${fullBlur}%` : 'auto';
      line.style.top = direction === 'top' ? `${fullBlur}%` : 'auto';
    });
  }

  debugToggle?.addEventListener('change', () => {
    debugEnabled = debugToggle.checked;
    document.body.classList.toggle('show-debug', debugEnabled);
    updateURL();
  });

  // Global text shadow toggle
  globalTextShadowToggle?.addEventListener('change', () => {
    textShadowEnabled = globalTextShadowToggle.checked;
    document.body.classList.toggle('no-text-shadow', !textShadowEnabled);
    updateURL();
  });

  // Global card shadow toggle
  globalCardShadowToggle?.addEventListener('change', () => {
    cardShadowEnabled = globalCardShadowToggle.checked;
    document.body.classList.toggle('no-card-shadow', !cardShadowEnabled);
    updateURL();
  });

  // Global text level
  document.querySelectorAll('input[name="global-text"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      textLevel = (e.target as HTMLInputElement).value;
      applyTextLevel();
      // Also update text-relative blur since text height changed
      requestAnimationFrame(() => updateRelBlur());
      updateURL();
    });
  });

  document.querySelectorAll('input[name="global-direction"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      direction = (e.target as HTMLInputElement).value;
      updateBlur();
      updateRelBlur();
      updateURL();
    });
  });

  // Global blur amount
  document.querySelectorAll('input[name="global-blur"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      blurAmount = parseInt((e.target as HTMLInputElement).value);
      updateBlur();
      updateRelBlur();
      updateComparisonBlur();
      updateURL();
    });
  });

  document.querySelectorAll('input[name="mask-start"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      blurEnd = parseInt((e.target as HTMLInputElement).value);
      updateBlur();
      updateURL();
    });
  });

  document.querySelectorAll('input[name="mask-end"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      fullBlur = parseInt((e.target as HTMLInputElement).value);
      updateBlur();
      updateURL();
    });
  });

  // Initialize controls from URL and apply blur
  initControls();
  updateBlur();

  // ========================================
  // TEXT-RELATIVE BLUR SECTION
  // ========================================

  const relBlurLayers = document.querySelectorAll('.rel-blur-layer') as NodeListOf<HTMLElement>;
  const relTextOverlays = document.querySelectorAll('.rel-text-overlay') as NodeListOf<HTMLElement>;
  const relDebugText = document.querySelectorAll('.rel-debug-line-text') as NodeListOf<HTMLElement>;
  const relDebugBlur = document.querySelectorAll('.rel-debug-line-blur') as NodeListOf<HTMLElement>;
  const relCards = document.querySelectorAll('.text-relative-card') as NodeListOf<HTMLElement>;
  const relDebugToggle = document.getElementById('rel-debug-lines') as HTMLInputElement;

  // Text-relative specific state (blur, text level, shadows use global values)
  let relSizingMode = params.get('rel_mode') || 'multiplier';
  let relFullBlurMult = parseFloat(params.get('rel_full_mult') || '1');
  let relBlurEndMult = parseFloat(params.get('rel_end_mult') || '1.25');
  let relBlurEndEm = parseFloat(params.get('rel_end_em') || '1');
  let relDebugEnabled = params.get('rel_debug') === '1';

  function updateRelURL() {
    // Merge with existing params
    const newParams = new URLSearchParams(window.location.search);

    if (relSizingMode !== 'multiplier') newParams.set('rel_mode', relSizingMode);
    else newParams.delete('rel_mode');

    // Full blur is always multiplier-based
    if (relFullBlurMult !== 1) newParams.set('rel_full_mult', String(relFullBlurMult));
    else newParams.delete('rel_full_mult');

    // Blur end depends on mode
    if (relSizingMode === 'multiplier') {
      if (relBlurEndMult !== 1.25) newParams.set('rel_end_mult', String(relBlurEndMult));
      else newParams.delete('rel_end_mult');
      newParams.delete('rel_end_em');
    } else {
      if (relBlurEndEm !== 1) newParams.set('rel_end_em', String(relBlurEndEm));
      else newParams.delete('rel_end_em');
      newParams.delete('rel_end_mult');
    }

    if (relDebugEnabled) newParams.set('rel_debug', '1');
    else newParams.delete('rel_debug');

    const newURL = newParams.toString()
      ? `${window.location.pathname}?${newParams.toString()}`
      : window.location.pathname;
    window.history.replaceState({}, '', newURL);
  }

  function initRelControls() {
    // Sizing mode
    const modeRadio = document.querySelector(`input[name="rel-sizing-mode"][value="${relSizingMode}"]`) as HTMLInputElement;
    if (modeRadio) modeRadio.checked = true;

    // Show/hide appropriate controls
    const multControls = document.querySelector('.rel-controls-multiplier') as HTMLElement;
    const emControls = document.querySelector('.rel-controls-em') as HTMLElement;
    if (multControls) multControls.style.display = relSizingMode === 'multiplier' ? '' : 'none';
    if (emControls) emControls.style.display = relSizingMode === 'em' ? '' : 'none';

    // Full blur multiplier control (always used)
    const fullMultRadio = document.querySelector(`input[name="rel-full-mult"][value="${relFullBlurMult}"]`) as HTMLInputElement;
    if (fullMultRadio) fullMultRadio.checked = true;

    // Blur end multiplier controls
    const endMultRadio = document.querySelector(`input[name="rel-end-mult"][value="${relBlurEndMult}"]`) as HTMLInputElement;
    if (endMultRadio) endMultRadio.checked = true;

    // Blur end em controls
    const endEmRadio = document.querySelector(`input[name="rel-end-em"][value="${relBlurEndEm}"]`) as HTMLInputElement;
    if (endEmRadio) endEmRadio.checked = true;

    if (relDebugToggle) {
      relDebugToggle.checked = relDebugEnabled;
      document.body.classList.toggle('show-rel-debug', relDebugEnabled);
    }
  }

  function updateRelBlur() {
    const config = directionConfig[direction];

    relCards.forEach((card, index) => {
      const blurLayer = card.querySelector('.rel-blur-layer') as HTMLElement;
      const textOverlay = card.querySelector('.rel-text-overlay') as HTMLElement;
      const debugText = card.querySelector('.rel-debug-line-text') as HTMLElement;
      const debugBlur = card.querySelector('.rel-debug-line-blur') as HTMLElement;

      if (!blurLayer || !textOverlay) return;

      // Apply text position based on direction
      applyTextPosition(textOverlay, config);

      const cardSize = config.isHorizontal ? card.offsetWidth : card.offsetHeight;
      const textSize = config.isHorizontal ? textOverlay.offsetWidth : textOverlay.offsetHeight;

      // Calculate blur boundaries based on sizing mode
      let fullBlurPx, blurEndPx;

      // Full blur is always multiplier-based
      fullBlurPx = textSize * relFullBlurMult;

      // Blur end depends on mode
      if (relSizingMode === 'multiplier') {
        blurEndPx = textSize * relBlurEndMult;
      } else {
        // Em mode: based on title font size
        const title = textOverlay.querySelector('h3') as HTMLElement;
        const titleFontSize = title ? parseFloat(getComputedStyle(title).fontSize) : 20;
        blurEndPx = fullBlurPx + (titleFontSize * relBlurEndEm);
      }

      // Convert to percentages
      const fullBlurPct = (fullBlurPx / cardSize) * 100;
      const blurEndPct = Math.min((blurEndPx / cardSize) * 100, 100);

      // Apply blur (uses global blurAmount and direction)
      blurLayer.style.backdropFilter = `blur(${blurAmount}px)`;
      blurLayer.style.webkitBackdropFilter = `blur(${blurAmount}px)`;
      blurLayer.style.maskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;
      blurLayer.style.webkitMaskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;

      // Update debug lines based on direction
      if (debugText) {
        if (config.isHorizontal) {
          // Vertical lines for left/right directions
          debugText.style.left = direction === 'left' ? `${fullBlurPx}px` : 'auto';
          debugText.style.right = direction === 'right' ? `${fullBlurPx}px` : 'auto';
          debugText.style.top = '0';
          debugText.style.bottom = '0';
          debugText.style.width = '2px';
          debugText.style.height = 'auto';
        } else {
          // Horizontal lines for top/bottom directions
          debugText.style.bottom = direction === 'bottom' ? `${fullBlurPx}px` : 'auto';
          debugText.style.top = direction === 'top' ? `${fullBlurPx}px` : 'auto';
          debugText.style.left = '0';
          debugText.style.right = '0';
          debugText.style.height = '2px';
          debugText.style.width = 'auto';
        }
      }
      if (debugBlur) {
        if (config.isHorizontal) {
          // Vertical lines for left/right directions
          debugBlur.style.left = direction === 'left' ? `${blurEndPx}px` : 'auto';
          debugBlur.style.right = direction === 'right' ? `${blurEndPx}px` : 'auto';
          debugBlur.style.top = '0';
          debugBlur.style.bottom = '0';
          debugBlur.style.width = '2px';
          debugBlur.style.height = 'auto';
        } else {
          // Horizontal lines for top/bottom directions
          debugBlur.style.bottom = direction === 'bottom' ? `${blurEndPx}px` : 'auto';
          debugBlur.style.top = direction === 'top' ? `${blurEndPx}px` : 'auto';
          debugBlur.style.left = '0';
          debugBlur.style.right = '0';
          debugBlur.style.height = '2px';
          debugBlur.style.width = 'auto';
        }
      }
    });

    // Also update comparison
    updateComparisonBlur();
  }

  relDebugToggle?.addEventListener('change', () => {
    relDebugEnabled = relDebugToggle.checked;
    document.body.classList.toggle('show-rel-debug', relDebugEnabled);
    updateRelURL();
  });

  // Sizing mode toggle
  document.querySelectorAll('input[name="rel-sizing-mode"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      relSizingMode = (e.target as HTMLInputElement).value;

      // Show/hide appropriate controls
      const multControls = document.querySelector('.rel-controls-multiplier') as HTMLElement;
      const emControls = document.querySelector('.rel-controls-em') as HTMLElement;
      if (multControls) multControls.style.display = relSizingMode === 'multiplier' ? '' : 'none';
      if (emControls) emControls.style.display = relSizingMode === 'em' ? '' : 'none';

      updateRelBlur();
      updateRelURL();
      updateComparisonBlur();
    });
  });

  // Multiplier mode controls
  document.querySelectorAll('input[name="rel-full-mult"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      relFullBlurMult = parseFloat((e.target as HTMLInputElement).value);
      updateRelBlur();
      updateRelURL();
    });
  });

  document.querySelectorAll('input[name="rel-end-mult"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      relBlurEndMult = parseFloat((e.target as HTMLInputElement).value);
      updateRelBlur();
      updateRelURL();
    });
  });

  // Em mode control for blur end
  document.querySelectorAll('input[name="rel-end-em"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      relBlurEndEm = parseFloat((e.target as HTMLInputElement).value);
      updateRelBlur();
      updateRelURL();
      updateComparisonBlur();
    });
  });

  // ========================================
  // COMPARISON SLIDER SECTION
  // ========================================

  const comparisonContainer = document.querySelector('.comparison-container') as HTMLElement;
  const comparisonCards = document.querySelectorAll('.comparison-card') as NodeListOf<HTMLElement>;

  function applyComparisonTextLevel() {
    comparisonCards.forEach(card => {
      const textLeft = card.querySelector('.comparison-text-left') as HTMLElement;
      const textRight = card.querySelector('.comparison-text-right') as HTMLElement;

      [textLeft, textRight].forEach(overlay => {
        if (!overlay) return;
        const subtitle = overlay.querySelector('.subtitle') as HTMLElement;
        const description = overlay.querySelector('.description') as HTMLElement;

        if (relTextLevel === 'title') {
          if (subtitle) subtitle.style.display = 'none';
          if (description) description.style.display = 'none';
        } else if (relTextLevel === 'subtitle') {
          if (subtitle) subtitle.style.display = '';
          if (description) description.style.display = 'none';
        } else {
          if (subtitle) subtitle.style.display = '';
          if (description) description.style.display = '';
        }
      });
    });
  }

  function updateComparisonBlur() {
    const config = directionConfig[direction];

    comparisonCards.forEach(card => {
      const blurLeft = card.querySelector('.comparison-blur-left') as HTMLElement;
      const blurRight = card.querySelector('.comparison-blur-right') as HTMLElement;
      const textLeft = card.querySelector('.comparison-text-left') as HTMLElement;
      const textRight = card.querySelector('.comparison-text-right') as HTMLElement;
      const debugLeftFull = card.querySelector('.comparison-debug-left-full') as HTMLElement;
      const debugLeftEnd = card.querySelector('.comparison-debug-left-end') as HTMLElement;
      const debugRightText = card.querySelector('.comparison-debug-right-text') as HTMLElement;
      const debugRightBlur = card.querySelector('.comparison-debug-right-blur') as HTMLElement;

      if (!blurLeft || !blurRight) return;

      const cardSize = config.isHorizontal ? card.offsetWidth : card.offsetHeight;

      // Apply text positioning to both sides
      if (textLeft) applyTextPosition(textLeft, config);
      if (textRight) applyTextPosition(textRight, config);

      // Left side: percentage-based (uses main controls)
      blurLeft.style.backdropFilter = `blur(${blurAmount}px)`;
      blurLeft.style.webkitBackdropFilter = `blur(${blurAmount}px)`;
      blurLeft.style.maskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlur}%, transparent ${blurEnd}%)`;
      blurLeft.style.webkitMaskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlur}%, transparent ${blurEnd}%)`;

      // Right side: text-relative (uses global blurAmount)
      if (textRight) {
        const textSize = config.isHorizontal ? textRight.offsetWidth : textRight.offsetHeight;

        // Calculate blur boundaries based on sizing mode
        let fullBlurPx, blurEndPx;

        // Full blur is always multiplier-based
        fullBlurPx = textSize * relFullBlurMult;

        // Blur end depends on mode
        if (relSizingMode === 'multiplier') {
          blurEndPx = textSize * relBlurEndMult;
        } else {
          // Em mode: based on title font size
          const title = textRight.querySelector('h3') as HTMLElement;
          const titleFontSize = title ? parseFloat(getComputedStyle(title).fontSize) : 20;
          blurEndPx = fullBlurPx + (titleFontSize * relBlurEndEm);
        }

        const fullBlurPct = (fullBlurPx / cardSize) * 100;
        const blurEndPct = Math.min((blurEndPx / cardSize) * 100, 100);

        blurRight.style.backdropFilter = `blur(${blurAmount}px)`;
        blurRight.style.webkitBackdropFilter = `blur(${blurAmount}px)`;
        blurRight.style.maskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;
        blurRight.style.webkitMaskImage = `linear-gradient(${config.gradientDir}, black 0%, black ${fullBlurPct}%, transparent ${blurEndPct}%)`;

        // Debug lines for right side
        if (debugRightText) {
          if (config.isHorizontal) {
            // Vertical lines for left/right directions
            debugRightText.style.left = direction === 'left' ? `${fullBlurPx}px` : 'auto';
            debugRightText.style.right = direction === 'right' ? `${fullBlurPx}px` : 'auto';
            debugRightText.style.top = '0';
            debugRightText.style.bottom = '0';
            debugRightText.style.width = '2px';
            debugRightText.style.height = 'auto';
          } else {
            // Horizontal lines for top/bottom directions
            debugRightText.style.bottom = direction === 'bottom' ? `${fullBlurPx}px` : 'auto';
            debugRightText.style.top = direction === 'top' ? `${fullBlurPx}px` : 'auto';
            debugRightText.style.left = '0';
            debugRightText.style.right = '0';
            debugRightText.style.height = '2px';
            debugRightText.style.width = 'auto';
          }
        }
        if (debugRightBlur) {
          if (config.isHorizontal) {
            // Vertical lines for left/right directions
            debugRightBlur.style.left = direction === 'left' ? `${blurEndPx}px` : 'auto';
            debugRightBlur.style.right = direction === 'right' ? `${blurEndPx}px` : 'auto';
            debugRightBlur.style.top = '0';
            debugRightBlur.style.bottom = '0';
            debugRightBlur.style.width = '2px';
            debugRightBlur.style.height = 'auto';
          } else {
            // Horizontal lines for top/bottom directions
            debugRightBlur.style.bottom = direction === 'bottom' ? `${blurEndPx}px` : 'auto';
            debugRightBlur.style.top = direction === 'top' ? `${blurEndPx}px` : 'auto';
            debugRightBlur.style.left = '0';
            debugRightBlur.style.right = '0';
            debugRightBlur.style.height = '2px';
            debugRightBlur.style.width = 'auto';
          }
        }
      }

      // Debug lines for left side
      if (debugLeftFull) {
        debugLeftFull.style.bottom = direction === 'bottom' ? `${fullBlur}%` : 'auto';
        debugLeftFull.style.top = direction === 'top' ? `${fullBlur}%` : 'auto';
      }
      if (debugLeftEnd) {
        debugLeftEnd.style.bottom = direction === 'bottom' ? `${blurEnd}%` : 'auto';
        debugLeftEnd.style.top = direction === 'top' ? `${blurEnd}%` : 'auto';
      }
    });
  }

  // Slider drag handling - Single shared position for all sliders
  let sliderPosition = 50;
  let isDragging = false;
  let activeCard: HTMLElement | null = null;

  // Function to update ALL slider positions
  function updateAllSliders(percent: number) {
    sliderPosition = percent;

    comparisonCards.forEach(card => {
      const slider = card.querySelector('.comparison-slider') as HTMLElement;
      const leftSide = card.querySelector('.comparison-left') as HTMLElement;
      const rightSide = card.querySelector('.comparison-right') as HTMLElement;

      if (!slider || !leftSide || !rightSide) return;

      // Update slider position
      slider.style.left = `${percent}%`;

      // Update clip-path for both sides
      leftSide.style.clipPath = `inset(0 ${100 - percent}% 0 0)`;
      rightSide.style.clipPath = `inset(0 0 0 ${percent}%)`;
    });
  }

  // Function to get slider percent for a specific card
  function getSliderPercent(e: MouseEvent | TouchEvent, targetCard: HTMLElement): number {
    const rect = targetCard.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    return Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
  }

  // Initialize all comparison cards with slider functionality
  comparisonCards.forEach(card => {
    const slider = card.querySelector('.comparison-slider') as HTMLElement;

    if (!slider) return;

    // Mouse event handlers
    slider.addEventListener('mousedown', (e) => {
      isDragging = true;
      activeCard = card;
      e.preventDefault();
    });

    card.addEventListener('mousedown', (e) => {
      if (e.target === slider || (e.target as HTMLElement).closest('.comparison-slider')) return;
      isDragging = true;
      activeCard = card;
      updateAllSliders(getSliderPercent(e, card));
    });

    // Touch event handlers
    slider.addEventListener('touchstart', (e) => {
      isDragging = true;
      activeCard = card;
      e.preventDefault();
    });

    card.addEventListener('touchstart', (e) => {
      if (e.target === slider || (e.target as HTMLElement).closest('.comparison-slider')) return;
      isDragging = true;
      activeCard = card;
      updateAllSliders(getSliderPercent(e, card));
    });
  });

  // Global mouse/touch move and up handlers
  document.addEventListener('mousemove', (e) => {
    if (!activeCard || !isDragging) return;

    const rect = activeCard.getBoundingClientRect();
    const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
    updateAllSliders(percent);
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    activeCard = null;
  });

  document.addEventListener('touchmove', (e) => {
    if (!activeCard || !isDragging) return;

    const rect = activeCard.getBoundingClientRect();
    const percent = Math.max(0, Math.min(100, ((e.touches[0].clientX - rect.left) / rect.width) * 100));
    updateAllSliders(percent);
  });

  document.addEventListener('touchend', () => {
    isDragging = false;
    activeCard = null;
  });

  // Initialize all sliders to 50%
  updateAllSliders(50);

  // Initialize text-relative section
  initRelControls();
  updateRelBlur();
</script>

<style>
  h1 {
    margin-top: 20px;
  }

  .demo-controls {
    display: flex;
    gap: 16px 24px;
    justify-content: center;
    align-items: flex-start;
    margin-bottom: 32px;
    padding: 16px;
    background: var(--bg-movie);
    border-radius: 8px;
    max-width: 950px;
    margin-left: auto;
    margin-right: auto;
    flex-wrap: wrap;
  }

  .control-row {
    display: flex;
    gap: 16px;
    align-items: center;
    width: 100%;
    justify-content: center;
  }

  .demo-container {
    display: flex;
    justify-content: center;
    padding: 32px 16px;
  }

  .poster-card {
    position: relative;
    width: 300px;
    height: 450px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    transition: box-shadow 0.2s;
  }

  /* Text level visibility */
  :global(body.text-title-only) .text-overlay > p {
    display: none;
  }

  :global(body.text-with-subtitle) .text-overlay .description {
    display: none;
  }

  .poster-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .blur-layer {
    position: absolute;
    inset: 0;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    /* Gradient: opaque at bottom (blurred), transparent at top (clear) */
    mask-image: linear-gradient(to top, black 0%, black 15%, transparent 50%);
    -webkit-mask-image: linear-gradient(to top, black 0%, black 15%, transparent 50%);
    pointer-events: none;
    z-index: 1;
  }

  .text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    color: white;
    z-index: 2;
  }

  .text-overlay h3 {
    margin: 0 0 4px 0;
    font-size: 24px;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  }

  .text-overlay p {
    margin: 0;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.85);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .text-overlay .description {
    margin-top: 8px;
    font-size: 13px;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.75);
  }

  .info-section {
    max-width: 600px;
    margin: 32px auto;
    padding: 24px;
    background: var(--bg-movie);
    border-radius: 8px;
  }

  .info-section h2 {
    margin: 0 0 12px 0;
    font-size: 18px;
    color: var(--text-primary);
  }

  .info-section p {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .info-section code {
    background: var(--bg-movie-hover);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
  }

  .info-section pre {
    background: var(--bg-movie-hover);
    padding: 12px 16px;
    border-radius: 6px;
    overflow-x: auto;
    margin: 12px 0;
  }

  .info-section pre code {
    background: none;
    padding: 0;
    font-size: 12px;
    line-height: 1.5;
    color: var(--text-primary);
  }

  .caveat {
    background: rgba(255, 180, 0, 0.1);
    border-left: 3px solid rgba(255, 180, 0, 0.5);
    padding: 12px;
    border-radius: 0 6px 6px 0;
    margin-top: 16px;
  }

  /* Debug toggle styling */
  .debug-toggle {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
  }

  .debug-toggle input {
    cursor: pointer;
  }

  /* Debug lines - hidden by default, shown with body.show-debug */
  .debug-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    pointer-events: none;
    z-index: 10;
    display: none;
  }

  :global(body.show-debug) .debug-line {
    display: block;
  }

  .debug-line-reach {
    background: #00ff88;
    box-shadow: 0 0 4px #00ff88;
  }

  .debug-line-full {
    background: #ff4488;
    box-shadow: 0 0 4px #ff4488;
  }

  /* Aspect ratio section */
  .aspect-ratio-section {
    max-width: 1200px;
    margin: 48px auto;
    padding: 0 16px;
  }

  .aspect-ratio-section h2 {
    margin: 0 0 8px 0;
    font-size: 18px;
    color: var(--text-primary);
  }

  .section-note {
    color: var(--text-tertiary);
    font-size: 14px;
    margin: 0 0 24px 0;
  }

  .aspect-ratio-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    align-items: flex-end;
  }

  .aspect-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .aspect-label {
    font-size: 12px;
    color: var(--text-tertiary);
    font-family: monospace;
  }

  /* Aspect ratio cards - larger sizes */
  .poster-card.aspect-2-3 {
    width: 240px;
    height: 360px;
  }

  .poster-card.aspect-1-1 {
    width: 280px;
    height: 280px;
  }

  .poster-card.aspect-3-4 {
    width: 240px;
    height: 320px;
  }

  .poster-card.aspect-4-3 {
    width: 320px;
    height: 240px;
  }

  .poster-card.aspect-16-9 {
    width: 400px;
    height: 225px;
  }

  .poster-card.aspect-2-1 {
    width: 440px;
    height: 220px;
  }

  .poster-card.aspect-9-16 {
    width: 200px;
    height: 356px;
  }

  .poster-card.aspect-1-2 {
    width: 180px;
    height: 360px;
  }

  /* Text for aspect ratio cards */
  .aspect-ratio-grid .text-overlay {
    padding: 16px;
  }

  .aspect-ratio-grid .text-overlay h3 {
    font-size: 18px;
  }

  .aspect-ratio-grid .text-overlay p {
    font-size: 13px;
  }

  /* ========================================
     TEXT-RELATIVE BLUR SECTION
     ======================================== */

  .text-relative-section {
    max-width: 1200px;
    margin: 64px auto 48px;
    padding: 0 16px;
  }

  .text-relative-section h2 {
    margin: 0 0 8px 0;
    font-size: 24px;
    color: var(--text-primary);
  }

  .section-intro {
    color: var(--text-secondary);
    font-size: 14px;
    margin: 0 0 24px 0;
    max-width: 600px;
  }

  .text-relative-controls {
    max-width: 800px;
    margin-left: 0;
    margin-right: auto;
  }

  .text-relative-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    align-items: flex-end;
  }

  /* Text-relative debug lines */
  .rel-debug-line-text {
    background: #ff4488;
    box-shadow: 0 0 4px #ff4488;
    display: none;
  }

  .rel-debug-line-blur {
    background: #00ff88;
    box-shadow: 0 0 4px #00ff88;
    display: none;
  }

  :global(body.show-rel-debug) .rel-debug-line-text,
  :global(body.show-rel-debug) .rel-debug-line-blur {
    display: block;
  }


  /* ========================================
     COMPARISON SLIDER SECTION
     ======================================== */

  .comparison-section {
    max-width: 800px;
    margin: 64px auto 48px;
    padding: 0 16px;
  }

  .comparison-section h2 {
    margin: 0 0 8px 0;
    font-size: 24px;
    color: var(--text-primary);
  }

  .comparison-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
    margin-top: 24px;
  }

  /* First 4 wide cards (2:1, 16:9, 4:3, 1:1) span 2 columns each */
  .comparison-container .aspect-card-wrapper:nth-child(-n+4) {
    grid-column: span 2;
  }

  /* Last 4 narrow cards (3:4, 2:3, 9:16, 1:2) each take 1 column - single row */
  .comparison-container .aspect-card-wrapper:nth-child(n+5) {
    grid-column: span 1;
  }

  .comparison-card {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    cursor: ew-resize;
  }

  /* Comparison card aspect ratio sizes - match text-relative-grid pattern */
  .comparison-container .aspect-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .comparison-container .aspect-label {
    font-size: 12px;
    color: var(--text-tertiary);
    font-family: monospace;
  }

  /* All comparison cards have uniform 320px height, widths adjusted for aspect ratio */
  .comparison-card.aspect-2-1 {
    width: 640px;
    height: 320px;
  }

  .comparison-card.aspect-16-9 {
    width: 569px;
    height: 320px;
  }

  .comparison-card.aspect-4-3 {
    width: 427px;
    height: 320px;
  }

  .comparison-card.aspect-1-1 {
    width: 320px;
    height: 320px;
  }

  .comparison-card.aspect-3-4 {
    width: 240px;
    height: 320px;
  }

  .comparison-card.aspect-2-3 {
    width: 213px;
    height: 320px;
  }

  .comparison-card.aspect-9-16 {
    width: 180px;
    height: 320px;
  }

  .comparison-card.aspect-1-2 {
    width: 160px;
    height: 320px;
  }

  .comparison-card > .poster-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
  }

  .comparison-side {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }

  .comparison-left {
    clip-path: inset(0 50% 0 0);
    z-index: 1;
  }

  .comparison-right {
    clip-path: inset(0 0 0 50%);
    z-index: 1;
  }

  .comparison-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
  }

  .comparison-side .blur-layer {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  .comparison-side .text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    color: white;
    z-index: 2;
  }

  .comparison-side .text-overlay h3 {
    margin: 0 0 4px 0;
    font-size: 20px;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  }

  .comparison-side .text-overlay p {
    margin: 0;
    font-size: 13px;
    color: rgba(255, 255, 255, 0.85);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .comparison-side .text-overlay .description {
    margin-top: 6px;
    font-size: 12px;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.75);
  }

  .comparison-label {
    position: absolute;
    top: 12px;
    padding: 4px 10px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: 11px;
    font-weight: 500;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 5;
  }

  .comparison-left .comparison-label {
    left: 12px;
  }

  .comparison-right .comparison-label {
    right: 12px;
  }

  .comparison-slider {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 50%;
    width: 4px;
    background: white;
    transform: translateX(-50%);
    z-index: 10;
    cursor: ew-resize;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
  }

  .slider-handle {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .slider-handle::before {
    content: '⟷';
    font-size: 18px;
    color: #333;
  }

  /* Comparison debug lines */
  .comparison-side .debug-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    pointer-events: none;
    z-index: 10;
    display: none;
  }

  .comparison-debug-left-full,
  .comparison-debug-right-text {
    background: #ff4488;
    box-shadow: 0 0 4px #ff4488;
  }

  .comparison-debug-left-end,
  .comparison-debug-right-blur {
    background: #00ff88;
    box-shadow: 0 0 4px #00ff88;
  }

  :global(body.show-debug) .comparison-debug-left-full,
  :global(body.show-debug) .comparison-debug-left-end {
    display: block;
  }

  :global(body.show-rel-debug) .comparison-debug-right-text,
  :global(body.show-rel-debug) .comparison-debug-right-blur {
    display: block;
  }

  /* Global shadow toggles - apply to all sections */
  :global(body.no-text-shadow) .text-overlay h3,
  :global(body.no-text-shadow) .text-overlay p {
    text-shadow: none;
  }

  :global(body.no-card-shadow) .poster-card,
  :global(body.no-card-shadow) .comparison-card {
    box-shadow: none;
  }

  /* ========================================
     FLOATING GLOBAL CONTROLS
     ======================================== */

  .floating-controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 24px;
    padding: 12px 24px;
    background: var(--bg-body);
    border-top: 1px solid var(--bg-movie-hover);
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
    z-index: 100;
    flex-wrap: wrap;
  }

  /* Add padding to body so content isn't hidden behind floating bar */
  :global(body) {
    padding-bottom: 80px;
  }
</style>
