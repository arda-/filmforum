---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Progressive Blur Demo">
  <h1>Progressive Blur</h1>
  <p class="subtitle">7-layer stacked blur with true intensity fade (Apple-style)</p>

  <div class="demo-controls">
    <div class="layer-toggles">
      <span class="control-label">Layers:</span>
      <div class="layer-buttons">
        <label class="layer-toggle">
          <input type="checkbox" data-layer="1" checked />
          <span>1px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="2" checked />
          <span>2px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="3" checked />
          <span>4px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="4" checked />
          <span>8px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="5" checked />
          <span>16px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="6" checked />
          <span>32px</span>
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="7" checked />
          <span>64px</span>
        </label>
      </div>
    </div>
    <button class="toggle-all-btn" id="toggle-all">Toggle All</button>
    <label class="debug-toggle">
      <input type="checkbox" id="debug-colors" />
      <span>Debug Colors</span>
    </label>
    <label class="debug-toggle">
      <input type="checkbox" id="enable-blur" checked />
      <span>Blur</span>
    </label>
    <label class="debug-toggle">
      <input type="checkbox" id="text-relative" />
      <span>Text-Relative</span>
    </label>
    <div class="slider-group">
      <label class="slider-control">
        <span class="slider-label">Start: <span id="blur-start-value">0%</span></span>
        <input type="range" id="blur-start" min="0" max="100" step="5" value="0" />
      </label>
      <label class="slider-control">
        <span class="slider-label">End: <span id="blur-end-value">100%</span></span>
        <input type="range" id="blur-end" min="0" max="100" step="5" value="100" />
      </label>
    </div>
  </div>

  <div class="demo-container">
    <div class="poster-card">
      <img src="/posters/taxi-driver.png" alt="Taxi Driver poster" class="poster-image" />
      <div class="progressive-blur">
        <div class="blur-layer layer-1" data-layer="1"></div>
        <div class="blur-layer layer-2" data-layer="2"></div>
        <div class="blur-layer layer-3" data-layer="3"></div>
        <div class="blur-layer layer-4" data-layer="4"></div>
        <div class="blur-layer layer-5" data-layer="5"></div>
        <div class="blur-layer layer-6" data-layer="6"></div>
        <div class="blur-layer layer-7" data-layer="7"></div>
      </div>
      <div class="text-overlay">
        <h3>Taxi Driver</h3>
        <p>Martin Scorsese • 1976</p>
        <p class="description">A mentally unstable veteran works as a nighttime taxi driver in New York City, where the perceived decadence and sleaze fuels his urge for violent action.</p>
      </div>
    </div>

  </div>

  <div class="comparison-section">
    <h2>Comparison</h2>
    <div class="comparison-grid">
      <div class="comparison-card">
        <div class="poster-card small">
          <img src="/posters/mean-streets.png" alt="Mean Streets poster" class="poster-image" />
          <div class="simple-blur-layer"></div>
          <div class="text-overlay small">
            <h3>Mean Streets</h3>
            <p>Scorsese • 1973</p>
          </div>
        </div>
        <span class="comparison-label">Simple (single layer)</span>
      </div>
      <div class="comparison-card">
        <div class="poster-card small">
          <img src="/posters/mean-streets.png" alt="Mean Streets poster" class="poster-image" />
          <div class="progressive-blur">
            <div class="blur-layer layer-1"></div>
            <div class="blur-layer layer-2"></div>
            <div class="blur-layer layer-3"></div>
            <div class="blur-layer layer-4"></div>
            <div class="blur-layer layer-5"></div>
            <div class="blur-layer layer-6"></div>
            <div class="blur-layer layer-7"></div>
          </div>
          <div class="text-overlay small">
            <h3>Mean Streets</h3>
            <p>Scorsese • 1973</p>
          </div>
        </div>
        <span class="comparison-label">Progressive (7 layers)</span>
      </div>
    </div>
  </div>

  <div class="info-section">
    <h2>How it works</h2>
    <p>Seven blur layers are stacked, each with increasing blur values (1px → 2px → 4px → 8px → 16px → 32px → 64px). Each layer is masked to cover a different vertical region with ~7% overlap, creating a smooth progression from sharp to heavily blurred.</p>
    <pre><code>/* Layer 1 (lightest) at top, Layer 7 (heaviest) at bottom */
.layer-1 {'{'} backdrop-filter: blur(1px);  mask: linear-gradient(to top, transparent 79%, black 86%, black 93%, transparent 100%); {'}'}
.layer-2 {'{'} backdrop-filter: blur(2px);  mask: linear-gradient(to top, transparent 65%, black 72%, black 79%, transparent 86%); {'}'}
.layer-3 {'{'} backdrop-filter: blur(4px);  mask: linear-gradient(to top, transparent 51%, black 58%, black 65%, transparent 72%); {'}'}
.layer-4 {'{'} backdrop-filter: blur(8px);  mask: linear-gradient(to top, transparent 36%, black 43%, black 51%, transparent 58%); {'}'}
.layer-5 {'{'} backdrop-filter: blur(16px); mask: linear-gradient(to top, transparent 22%, black 29%, black 36%, transparent 43%); {'}'}
.layer-6 {'{'} backdrop-filter: blur(32px); mask: linear-gradient(to top, transparent 8%, black 15%, black 22%, transparent 29%); {'}'}
.layer-7 {'{'} backdrop-filter: blur(64px); mask: linear-gradient(to top, black 0%, black 8%, transparent 15%); {'}'}</code></pre>
    <p class="note"><strong>Trade-off:</strong> More DOM elements and potential performance impact, but creates a much smoother, more natural blur gradient than single-layer approaches.</p>
  </div>
</Layout>

<script>
  const params = new URLSearchParams(window.location.search);
  const layerToggles = document.querySelectorAll('.layer-toggle input');
  const blurLayers = document.querySelectorAll('.poster-card:first-of-type .blur-layer');
  const toggleAllBtn = document.getElementById('toggle-all');

  // Layer toggle functionality
  layerToggles.forEach(toggle => {
    toggle.addEventListener('change', (e) => {
      const input = e.target as HTMLInputElement;
      const layerNum = input.dataset.layer;
      const isChecked = input.checked;

      // Update blur layer visibility
      blurLayers.forEach(layer => {
        if ((layer as HTMLElement).dataset.layer === layerNum) {
          (layer as HTMLElement).style.opacity = isChecked ? '1' : '0';
        }
      });

      updateURL();
    });
  });

  let allOn = true;
  toggleAllBtn?.addEventListener('click', () => {
    allOn = !allOn;
    layerToggles.forEach(toggle => {
      (toggle as HTMLInputElement).checked = allOn;
      toggle.dispatchEvent(new Event('change'));
    });
  });

  // URL management
  function updateURL() {
    const newParams = new URLSearchParams(window.location.search);

    for (let i = 1; i <= 7; i++) {
      const toggle = document.querySelector(`input[data-layer="${i}"]`) as HTMLInputElement;
      if (toggle && !toggle.checked) {
        newParams.set(`layer${i}`, '0');
      } else {
        newParams.delete(`layer${i}`);
      }
    }

    // Text-relative toggle
    if (textRelativeToggle?.checked) {
      newParams.set('text_rel', '1');
    } else {
      newParams.delete('text_rel');
    }

    // Slider values
    if (blurStartSlider?.value !== '0') {
      newParams.set('start', blurStartSlider.value);
    } else {
      newParams.delete('start');
    }
    if (blurEndSlider?.value !== '100') {
      newParams.set('end', blurEndSlider.value);
    } else {
      newParams.delete('end');
    }

    // Debug colors toggle
    if (debugColorsToggle?.checked) {
      newParams.set('debug', '1');
    } else {
      newParams.delete('debug');
    }

    const newURL = newParams.toString()
      ? `${window.location.pathname}?${newParams}`
      : window.location.pathname;
    history.replaceState({}, '', newURL);
  }

  // Debug color toggle
  const debugColorsToggle = document.getElementById('debug-colors') as HTMLInputElement;
  const enableBlurToggle = document.getElementById('enable-blur') as HTMLInputElement;
  const textRelativeToggle = document.getElementById('text-relative') as HTMLInputElement;
  const blurStartSlider = document.getElementById('blur-start') as HTMLInputElement;
  const blurEndSlider = document.getElementById('blur-end') as HTMLInputElement;
  const blurStartValue = document.getElementById('blur-start-value') as HTMLSpanElement;
  const blurEndValue = document.getElementById('blur-end-value') as HTMLSpanElement;

  debugColorsToggle?.addEventListener('change', () => {
    document.body.classList.toggle('debug-colors', debugColorsToggle.checked);
    updateURL();
  });

  enableBlurToggle?.addEventListener('change', () => {
    document.body.classList.toggle('blur-disabled', !enableBlurToggle.checked);
  });

  // Text-relative blur calculation
  function updateTextRelativeBlur() {
    const card = document.querySelector('.demo-container .poster-card') as HTMLElement;
    if (!card) return;

    const textOverlay = card.querySelector('.text-overlay') as HTMLElement;
    const layers = card.querySelectorAll('.blur-layer') as NodeListOf<HTMLElement>;
    if (!textOverlay) return;

    const cardHeight = card.offsetHeight;
    const textHeight = textOverlay.offsetHeight;

    // Blur zone extends from 0% to top of text overlay
    const blurEndPct = (textHeight / cardHeight) * 100;
    const scale = blurEndPct / 100;

    // Original smooth overlapping masks - scale them proportionally
    // These have ~15% overlap between adjacent layers for smooth blending
    const layerMasks = [
      { fadeIn: 70, solidStart: 85, solidEnd: 100 },  // layer-1 (top, lightest)
      { fadeIn: 55, solidStart: 70, solidEnd: 85, fadeOut: 100 },
      { fadeIn: 40, solidStart: 55, solidEnd: 70, fadeOut: 85 },
      { fadeIn: 25, solidStart: 40, solidEnd: 55, fadeOut: 70 },
      { fadeIn: 10, solidStart: 25, solidEnd: 40, fadeOut: 55 },
      { fadeIn: 0, solidStart: 10, solidEnd: 25, fadeOut: 40 },
      { fadeIn: 0, solidStart: 0, solidEnd: 10, fadeOut: 25 }   // layer-7 (bottom, heaviest)
    ];

    layers.forEach((layer, i) => {
      const mask = layerMasks[i];
      const fadeIn = mask.fadeIn * scale;
      const solidStart = mask.solidStart * scale;
      const solidEnd = Math.min(mask.solidEnd * scale, blurEndPct);
      const fadeOut = mask.fadeOut ? Math.min(mask.fadeOut * scale, blurEndPct) : blurEndPct;

      let gradient: string;
      if (i === 0) {
        // Layer 1 - top layer, cap at blur zone boundary
        gradient = `linear-gradient(to top, transparent ${fadeIn}%, black ${solidStart}%, black ${blurEndPct}%, transparent ${blurEndPct}%)`;
      } else if (i === 6) {
        // Layer 7 - bottom layer
        gradient = `linear-gradient(to top, black 0%, black ${solidEnd}%, transparent ${fadeOut}%)`;
      } else {
        gradient = `linear-gradient(to top, transparent ${fadeIn}%, black ${solidStart}%, black ${solidEnd}%, transparent ${fadeOut}%)`;
      }

      layer.style.maskImage = gradient;
      layer.style.webkitMaskImage = gradient;
    });
  }

  function resetToStaticMasks() {
    const card = document.querySelector('.demo-container .poster-card') as HTMLElement;
    if (!card) return;

    const layers = card.querySelectorAll('.blur-layer') as NodeListOf<HTMLElement>;

    // Reset to CSS-defined masks by removing inline styles
    layers.forEach(layer => {
      layer.style.maskImage = '';
      layer.style.webkitMaskImage = '';
    });
  }

  textRelativeToggle?.addEventListener('change', () => {
    if (textRelativeToggle.checked) {
      updateTextRelativeBlur();
    } else {
      // Check if sliders are at default (0-100), if so reset to static
      if (blurStartSlider.value === '0' && blurEndSlider.value === '100') {
        resetToStaticMasks();
      } else {
        updateBlurFromSliders();
      }
    }
    updateURL();
  });

  // Slider-controlled blur zone
  function updateBlurFromSliders() {
    const card = document.querySelector('.demo-container .poster-card') as HTMLElement;
    if (!card) return;

    const layers = card.querySelectorAll('.blur-layer') as NodeListOf<HTMLElement>;
    const startPct = parseFloat(blurStartSlider.value);
    const endPct = parseFloat(blurEndSlider.value);

    // Ensure start < end
    if (startPct >= endPct) return;

    const range = endPct - startPct;
    const scale = range / 100;

    // Original smooth overlapping masks - remap to startPct-endPct range
    const layerMasks = [
      { fadeIn: 70, solidStart: 85, solidEnd: 100 },
      { fadeIn: 55, solidStart: 70, solidEnd: 85, fadeOut: 100 },
      { fadeIn: 40, solidStart: 55, solidEnd: 70, fadeOut: 85 },
      { fadeIn: 25, solidStart: 40, solidEnd: 55, fadeOut: 70 },
      { fadeIn: 10, solidStart: 25, solidEnd: 40, fadeOut: 55 },
      { fadeIn: 0, solidStart: 10, solidEnd: 25, fadeOut: 40 },
      { fadeIn: 0, solidStart: 0, solidEnd: 10, fadeOut: 25 }
    ];

    layers.forEach((layer, i) => {
      const mask = layerMasks[i];
      const fadeIn = startPct + mask.fadeIn * scale;
      const solidStart = startPct + mask.solidStart * scale;
      const solidEnd = Math.min(startPct + mask.solidEnd * scale, endPct);
      const fadeOut = mask.fadeOut ? Math.min(startPct + mask.fadeOut * scale, endPct) : endPct;

      let gradient: string;
      if (i === 0) {
        // Layer 1 - top layer, cap at blur zone boundary
        gradient = `linear-gradient(to top, transparent ${fadeIn}%, black ${solidStart}%, black ${endPct}%, transparent ${endPct}%)`;
      } else if (i === 6) {
        // Layer 7 - bottom layer
        gradient = `linear-gradient(to top, black ${startPct}%, black ${solidEnd}%, transparent ${fadeOut}%)`;
      } else {
        gradient = `linear-gradient(to top, transparent ${fadeIn}%, black ${solidStart}%, black ${solidEnd}%, transparent ${fadeOut}%)`;
      }

      layer.style.maskImage = gradient;
      layer.style.webkitMaskImage = gradient;
    });
  }

  blurStartSlider?.addEventListener('input', () => {
    blurStartValue.textContent = `${blurStartSlider.value}%`;
    // Disable text-relative when using sliders
    if (textRelativeToggle.checked) {
      textRelativeToggle.checked = false;
    }
    updateBlurFromSliders();
    updateURL();
  });

  blurEndSlider?.addEventListener('input', () => {
    blurEndValue.textContent = `${blurEndSlider.value}%`;
    // Disable text-relative when using sliders
    if (textRelativeToggle.checked) {
      textRelativeToggle.checked = false;
    }
    updateBlurFromSliders();
    updateURL();
  });

  // Update on resize when text-relative is enabled
  window.addEventListener('resize', () => {
    if (textRelativeToggle?.checked) {
      updateTextRelativeBlur();
    }
  });

  // Initialize on load
  window.addEventListener('load', () => {
    // Restore layer toggles from URL
    for (let i = 1; i <= 7; i++) {
      if (params.get(`layer${i}`) === '0') {
        const toggle = document.querySelector(`input[data-layer="${i}"]`) as HTMLInputElement;
        if (toggle) {
          toggle.checked = false;
          toggle.dispatchEvent(new Event('change'));
        }
      }
    }

    // Restore slider values from URL
    const startParam = params.get('start');
    const endParam = params.get('end');
    if (startParam) {
      blurStartSlider.value = startParam;
      blurStartValue.textContent = `${startParam}%`;
    }
    if (endParam) {
      blurEndSlider.value = endParam;
      blurEndValue.textContent = `${endParam}%`;
    }

    // Apply slider values if not at defaults
    if (startParam || endParam) {
      updateBlurFromSliders();
    }

    // Restore text-relative toggle
    if (params.get('text_rel') === '1') {
      textRelativeToggle.checked = true;
      updateTextRelativeBlur();
    }

    // Restore debug colors toggle
    if (params.get('debug') === '1') {
      debugColorsToggle.checked = true;
      document.body.classList.add('debug-colors');
    }
  });
</script>

<style>
  h1 {
    margin-top: 20px;
  }

  .demo-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    align-items: center;
    margin-bottom: 32px;
    padding: 16px;
    background: var(--bg-movie);
    border-radius: 8px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  .layer-toggles {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .control-label {
    font-size: 14px;
    color: var(--text-secondary);
  }

  .layer-buttons {
    display: flex;
    gap: 4px;
  }

  .layer-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 10px;
    font-size: 12px;
    font-family: monospace;
    color: var(--text-secondary);
    background: transparent;
    border: 1px solid var(--bg-movie-hover);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .layer-toggle:has(input:checked) {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .layer-toggle input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .toggle-all-btn {
    padding: 6px 12px;
    font-size: 13px;
    background: var(--bg-movie-hover);
    border: 1px solid var(--bg-movie-hover);
    border-radius: 4px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s;
  }

  .toggle-all-btn:hover {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .debug-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--text-secondary);
    cursor: pointer;
  }

  .debug-toggle input {
    cursor: pointer;
  }

  .slider-group {
    display: flex;
    gap: 16px;
    padding: 8px 12px;
    background: var(--bg-movie-hover);
    border-radius: 6px;
  }

  .slider-control {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .slider-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-family: monospace;
  }

  input[type="range"] {
    -webkit-appearance: none;
    width: 120px;
    height: 4px;
    background: var(--bg-movie);
    border-radius: 2px;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s ease;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
  }

  input[type="range"]::-moz-range-thumb {
    width: 14px;
    height: 14px;
    background: var(--accent);
    border-radius: 50%;
    border: none;
    cursor: pointer;
  }

  .demo-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 32px;
    padding: 32px 16px;
    flex-wrap: wrap;
  }

  .poster-card {
    position: relative;
    width: 300px;
    height: 450px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  }

  .poster-card.small {
    width: 200px;
    height: 300px;
  }

  .poster-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .progressive-blur {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100%;
    pointer-events: none;
  }

  .blur-layer {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100%;
    transition: opacity 0.2s;
  }

  /* 7 layers with doubling blur values: 1, 2, 4, 8, 16, 32, 64 */
  /* Each layer fades in AND out to blend with neighbors */

  .layer-1 {
    backdrop-filter: blur(1px);
    -webkit-backdrop-filter: blur(1px);
    mask-image: linear-gradient(to top, transparent 70%, black 85%, black 100%);
    -webkit-mask-image: linear-gradient(to top, transparent 70%, black 85%, black 100%);
  }

  .layer-2 {
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    mask-image: linear-gradient(to top, transparent 55%, black 70%, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to top, transparent 55%, black 70%, black 85%, transparent 100%);
  }

  .layer-3 {
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    mask-image: linear-gradient(to top, transparent 40%, black 55%, black 70%, transparent 85%);
    -webkit-mask-image: linear-gradient(to top, transparent 40%, black 55%, black 70%, transparent 85%);
  }

  .layer-4 {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    mask-image: linear-gradient(to top, transparent 25%, black 40%, black 55%, transparent 70%);
    -webkit-mask-image: linear-gradient(to top, transparent 25%, black 40%, black 55%, transparent 70%);
  }

  .layer-5 {
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    mask-image: linear-gradient(to top, transparent 10%, black 25%, black 40%, transparent 55%);
    -webkit-mask-image: linear-gradient(to top, transparent 10%, black 25%, black 40%, transparent 55%);
  }

  .layer-6 {
    backdrop-filter: blur(32px);
    -webkit-backdrop-filter: blur(32px);
    mask-image: linear-gradient(to top, transparent 0%, black 10%, black 25%, transparent 40%);
    -webkit-mask-image: linear-gradient(to top, transparent 0%, black 10%, black 25%, transparent 40%);
  }

  .layer-7 {
    backdrop-filter: blur(64px);
    -webkit-backdrop-filter: blur(64px);
    mask-image: linear-gradient(to top, black 0%, black 10%, transparent 25%);
    -webkit-mask-image: linear-gradient(to top, black 0%, black 10%, transparent 25%);
  }

  /* Debug colors mode */
  body.debug-colors .layer-1 { background: rgba(0, 150, 255, 0.5); }
  body.debug-colors .layer-2 { background: rgba(0, 200, 255, 0.5); }
  body.debug-colors .layer-3 { background: rgba(0, 255, 200, 0.5); }
  body.debug-colors .layer-4 { background: rgba(100, 255, 100, 0.5); }
  body.debug-colors .layer-5 { background: rgba(200, 255, 0, 0.5); }
  body.debug-colors .layer-6 { background: rgba(255, 150, 0, 0.5); }
  body.debug-colors .layer-7 { background: rgba(255, 50, 50, 0.5); }

  /* Blur disabled mode - hide entire blur container */
  body.blur-disabled .progressive-blur,
  body.blur-disabled .simple-blur-layer {
    display: none !important;
  }

  .text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    color: white;
  }

  .text-overlay.small {
    padding: 12px;
  }

  .text-overlay h3 {
    margin: 0 0 4px 0;
    font-size: 24px;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  }

  .text-overlay.small h3 {
    font-size: 18px;
  }

  .text-overlay p {
    margin: 0;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.85);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .text-overlay.small p {
    font-size: 12px;
  }

  .text-overlay .description {
    margin-top: 8px;
    font-size: 13px;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.75);
  }

  /* Layer visualization */
  .layer-visualization {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .layer-visualization h3 {
    margin: 0;
    font-size: 14px;
    color: var(--text-secondary);
  }

  .mask-preview {
    width: 120px;
    height: 450px;
    background: var(--bg-movie);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }

  .mask-bar {
    position: absolute;
    left: 0;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s;
  }

  .mask-bar span {
    font-size: 11px;
    font-family: monospace;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* Position each bar to show its zone - 7 layers spanning 450px */
  /* Layer 7 at bottom (heaviest blur), Layer 1 at top (lightest) */
  .mask-bar.layer-7 { bottom: 0; height: 64px; background: hsl(80, 70%, 25%); }
  .mask-bar.layer-6 { bottom: 64px; height: 64px; background: hsl(100, 70%, 28%); }
  .mask-bar.layer-5 { bottom: 128px; height: 64px; background: hsl(120, 70%, 30%); }
  .mask-bar.layer-4 { bottom: 192px; height: 64px; background: hsl(140, 70%, 35%); }
  .mask-bar.layer-3 { bottom: 256px; height: 64px; background: hsl(160, 70%, 40%); }
  .mask-bar.layer-2 { bottom: 320px; height: 64px; background: hsl(180, 70%, 45%); }
  .mask-bar.layer-1 { bottom: 384px; height: 66px; background: hsl(200, 70%, 50%); }

  .mask-labels {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--text-tertiary);
    font-family: monospace;
  }

  /* Comparison section */
  .comparison-section {
    max-width: 600px;
    margin: 32px auto;
    padding: 0 16px;
  }

  .comparison-section h2 {
    margin: 0 0 16px 0;
    font-size: 18px;
    color: var(--text-primary);
  }

  .comparison-grid {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .comparison-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .comparison-label {
    font-size: 13px;
    color: var(--text-secondary);
  }

  /* Simple blur for comparison */
  .simple-blur-layer {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100%;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    mask-image: linear-gradient(to top, black 15%, transparent 50%);
    -webkit-mask-image: linear-gradient(to top, black 15%, transparent 50%);
    pointer-events: none;
  }

  /* Info section */
  .info-section {
    max-width: 600px;
    margin: 32px auto;
    padding: 24px;
    background: var(--bg-movie);
    border-radius: 8px;
  }

  .info-section h2 {
    margin: 0 0 12px 0;
    font-size: 18px;
    color: var(--text-primary);
  }

  .info-section p {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .info-section pre {
    background: var(--bg-movie-hover);
    padding: 12px 16px;
    border-radius: 6px;
    overflow-x: auto;
    margin: 12px 0;
  }

  .info-section pre code {
    font-size: 11px;
    line-height: 1.5;
    color: var(--text-primary);
  }

  .note {
    background: rgba(100, 150, 255, 0.1);
    border-left: 3px solid rgba(100, 150, 255, 0.5);
    padding: 12px;
    border-radius: 0 6px 6px 0;
    margin-top: 16px;
  }
</style>
