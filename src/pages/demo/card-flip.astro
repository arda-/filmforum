---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Card Flip" noindex={true}>
  <div class="demo-container">
    <h1>Card Flip (FLIP Animation)</h1>
    <p class="subtitle">Demonstrating the FLIP technique for smooth CSS animations</p>

    <div class="grid">
      {[
        { id: 3, title: 'FLIP + Smooth Close', desc: 'Smooth open and close' },
        { id: 2, title: 'FLIP Animation', desc: 'Smooth transform-based expansion' },
        { id: 1, title: 'Original', desc: 'Base card style' },
      ].map((card) => (
        <div class="card" data-id={card.id}>
          <div class="card-content">
            <div class="card-number">{card.id}</div>
            <div class="card-title">{card.title}</div>
            <div class="card-desc">{card.desc}</div>
          </div>
        </div>
      ))}
    </div>

    <div class="expanded-overlay" id="expandedOverlay">
      <div class="expanded-card" id="expandedCard">
        <button class="close-btn" id="closeBtn">Ã—</button>
        <div class="expanded-content">
          <span class="expanded-label" id="expandedLabel"></span>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  const cards = document.querySelectorAll('.card');
  const overlay = document.getElementById('expandedOverlay');
  const expandedCard = document.getElementById('expandedCard');
  const expandedLabel = document.getElementById('expandedLabel');
  const closeBtn = document.getElementById('closeBtn');

  let sourceCard = null;
  let sourceCardId = 0;

  function flipAnimation(element, callback) {
    const first = element.getBoundingClientRect();
    callback();
    const last = expandedCard.getBoundingClientRect();

    const deltaX = first.left - last.left;
    const deltaY = first.top - last.top;
    const deltaWidth = first.width / last.width;
    const deltaHeight = first.height / last.height;

    expandedCard.style.transformOrigin = '0 0';
    expandedCard.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${deltaWidth}, ${deltaHeight})`;
    expandedCard.style.transition = 'none';
    expandedCard.offsetHeight;

    expandedCard.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    expandedCard.style.transform = 'translate(0, 0) scale(1, 1)';
  }

  function closeInstant() {
    overlay.classList.remove('active');
    document.body.style.overflow = '';
    expandedCard.style.transform = '';
    expandedCard.style.transition = '';
    sourceCard = null;
  }

  function closeSmoothFlip() {
    if (!sourceCard) { closeInstant(); return; }

    const expandedRect = expandedCard.getBoundingClientRect();
    const targetRect = sourceCard.getBoundingClientRect();

    const deltaX = targetRect.left - expandedRect.left;
    const deltaY = targetRect.top - expandedRect.top;
    const scaleX = targetRect.width / expandedRect.width;
    const scaleY = targetRect.height / expandedRect.height;

    expandedCard.style.transformOrigin = '0 0';
    expandedCard.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    expandedCard.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${scaleX}, ${scaleY})`;

    expandedCard.addEventListener('transitionend', function handler(e) {
      if (e.propertyName !== 'transform') return;
      expandedCard.removeEventListener('transitionend', handler);
      overlay.classList.remove('active');
      document.body.style.overflow = '';
      expandedCard.style.transform = '';
      expandedCard.style.transition = '';
      expandedCard.style.transformOrigin = '';
      sourceCard = null;
    }, { once: false });
  }

  function handleClose() {
    if (sourceCardId === 3) {
      closeSmoothFlip();
    } else {
      closeInstant();
    }
  }

  cards.forEach((card) => {
    card.addEventListener('click', () => {
      const id = parseInt(card.dataset.id, 10);
      const number = card.querySelector('.card-number').textContent;
      expandedLabel.textContent = number;
      sourceCard = card;
      sourceCardId = id;

      flipAnimation(card, () => {
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });
  });

  closeBtn.addEventListener('click', handleClose);

  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      handleClose();
    }
  });
</script>

<style>
  .demo-container {
    margin: 0 auto;
    padding: 40px 20px;
  }

  h1 {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .subtitle {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 48px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  .card {
    aspect-ratio: 1;
    background: var(--bg-movie);
    border-radius: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-align: center;
    padding: 20px;
  }

  .card-number {
    font-size: 36px;
    font-weight: 700;
    color: var(--accent);
  }

  .card-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .card-desc {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .expanded-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    visibility: hidden;
    z-index: 1000;
  }

  .expanded-overlay.active {
    visibility: visible;
  }

  .expanded-card {
    position: relative;
    width: 100%;
    height: 85dvh;
    max-width: calc(100% - 40px);
    background: var(--bg-movie);
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 24px;
  }

  .close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 40px;
    height: 40px;
    border: none;
    background: var(--bg-body);
    color: var(--text-primary);
    border-radius: 50%;
    font-size: 28px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .expanded-content {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
  }

  .expanded-label {
    font-size: 72px;
    font-weight: 700;
    color: var(--accent);
  }

</style>
