---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Card Flip" noindex={true}>
  <div class="demo-container">
    <h1>Card Flip (FLIP Animation)</h1>
    <p class="subtitle">Demonstrating the FLIP technique for smooth CSS animations</p>

    <div class="grid">
      {[1, 2, 3, 4, 5, 6].map((num) => (
        <div class="card" data-id={num}>
          <div class="card-content">
            <span>{num}</span>
          </div>
        </div>
      ))}
    </div>

    <div class="expanded-overlay" id="expandedOverlay">
      <div class="expanded-card" id="expandedCard">
        <button class="close-btn" id="closeBtn">Ã—</button>
        <div class="expanded-content">
          <span class="expanded-label" id="expandedLabel"></span>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  const cards = document.querySelectorAll('.card');
  const overlay = document.getElementById('expandedOverlay');
  const expandedCard = document.getElementById('expandedCard');
  const expandedLabel = document.getElementById('expandedLabel');
  const closeBtn = document.getElementById('closeBtn');

  function flipAnimation(element, callback) {
    // FIRST: Record initial position and size
    const first = element.getBoundingClientRect();

    // Trigger the layout change
    callback();

    // LAST: Record final position and size
    const last = expandedCard.getBoundingClientRect();

    // INVERT: Calculate the difference and apply inverted transform
    const deltaX = first.left - last.left;
    const deltaY = first.top - last.top;
    const deltaWidth = first.width / last.width;
    const deltaHeight = first.height / last.height;

    // Apply the inverted transform
    expandedCard.style.transformOrigin = '0 0';
    expandedCard.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${deltaWidth}, ${deltaHeight})`;
    expandedCard.style.transition = 'none';

    // Force a reflow to ensure the transform is applied
    expandedCard.offsetHeight;

    // PLAY: Remove the transform and let it animate
    expandedCard.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    expandedCard.style.transform = 'translate(0, 0) scale(1, 1)';
  }

  function flipAnimationReverse(element, callback) {
    // FIRST: Record the current (expanded) position and size
    const first = expandedCard.getBoundingClientRect();

    // Apply inverted transform before layout change
    const last = element.getBoundingClientRect();
    const deltaX = first.left - last.left;
    const deltaY = first.top - last.top;
    const deltaWidth = first.width / last.width;
    const deltaHeight = first.height / last.height;

    expandedCard.style.transition = 'none';
    expandedCard.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${deltaWidth}, ${deltaHeight})`;

    // Force reflow
    expandedCard.offsetHeight;

    // Trigger the layout change
    callback();

    // PLAY: Animate to the inverted state
    expandedCard.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    expandedCard.style.transform = 'translate(0, 0) scale(1, 1)';

    // After animation, remove transform
    setTimeout(() => {
      expandedCard.style.transform = '';
      expandedCard.style.transition = '';
    }, 600);
  }

  cards.forEach((card) => {
    card.addEventListener('click', () => {
      const label = card.querySelector('span').textContent;
      expandedLabel.textContent = label;

      flipAnimation(card, () => {
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });
  });

  closeBtn.addEventListener('click', () => {
    flipAnimationReverse(cards[0], () => {
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    });
  });

  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      flipAnimationReverse(cards[0], () => {
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      });
    }
  });
</script>

<style>
  .demo-container {
    margin: 0 auto;
    padding: 40px 20px;
  }

  h1 {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .subtitle {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 48px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  .card {
    aspect-ratio: 1;
    background: linear-gradient(135deg, var(--bg-movie) 0%, var(--bg-body) 100%);
    border-radius: 1rem;
    cursor: pointer;
    border: 1px solid var(--bg-movie-hover);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, transform 0.15s;
  }

  .card:hover {
    background: linear-gradient(135deg, var(--bg-movie-hover) 0%, var(--bg-body) 100%);
    transform: scale(1.02);
  }

  .card-content {
    font-size: 28px;
    font-weight: 600;
    color: var(--accent);
  }

  .expanded-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 1000;
  }

  .expanded-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .expanded-card {
    position: relative;
    width: 100%;
    height: 85dvh;
    max-width: calc(100% - 40px);
    background: linear-gradient(135deg, var(--bg-movie) 0%, var(--bg-body) 100%);
    border-radius: 1rem;
    border: 1px solid var(--bg-movie-hover);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 24px;
  }

  .close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 40px;
    height: 40px;
    border: none;
    background: var(--bg-body);
    color: var(--text-primary);
    border-radius: 50%;
    font-size: 28px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    border: 1px solid var(--bg-movie-hover);
  }

  .close-btn:hover {
    background: var(--bg-movie);
  }

  .expanded-content {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
  }

  .expanded-label {
    font-size: 72px;
    font-weight: 700;
    color: var(--accent);
  }

  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
    }

    .expanded-card {
      max-width: 100%;
      width: 100%;
      border-radius: 0;
    }
  }
</style>
