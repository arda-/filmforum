---
/**
 * Sticky bottom bar for the calendar page.
 * Contains the Saved movies filter (floats above calendar).
 */
---

<div class="calendar-bottom-bar">
  <div class="saved-filter-container">
    <span class="saved-filter-label">Saved movies:</span>
    <div class="segmented-toggle" role="group" aria-label="Filter saved movies">
      <button
        class="seg-btn active"
        data-filter="yes"
        aria-pressed="true"
        aria-label="Show movies marked Yes"
        style="--btn-color: var(--reaction-yes)"
      >
        <input type="checkbox" name="saved-filter" value="yes" checked style="display: none;" />
        Yes
      </button>
      <button
        class="seg-btn active"
        data-filter="maybe"
        aria-pressed="true"
        aria-label="Show movies marked Maybe"
        style="--btn-color: var(--reaction-maybe)"
      >
        <input type="checkbox" name="saved-filter" value="maybe" checked style="display: none;" />
        Maybe
      </button>
      <button
        class="seg-btn"
        data-filter="no"
        aria-pressed="false"
        aria-label="Show movies marked No"
        style="--btn-color: var(--reaction-no)"
      >
        <input type="checkbox" name="saved-filter" value="no" style="display: none;" />
        No
      </button>
      <button
        class="seg-btn"
        data-filter="unmarked"
        aria-pressed="false"
        aria-label="Show unmarked movies"
      >
        <input type="checkbox" name="saved-filter" value="unmarked" style="display: none;" />
        Unmarked
      </button>
    </div>
    <span id="saved-filter-status" class="saved-filter-status"></span>
  </div>
</div>

<script>
  // Multi-select toggle buttons for saved filter
  const savedButtons = document.querySelectorAll('.calendar-bottom-bar .seg-btn');

  savedButtons.forEach(button => {
    button.addEventListener('click', () => {
      const checkbox = button.querySelector('input[type="checkbox"]') as HTMLInputElement;
      if (checkbox) {
        // Toggle the checkbox state
        checkbox.checked = !checkbox.checked;

        // Update button visual state
        button.classList.toggle('active', checkbox.checked);
        button.setAttribute('aria-pressed', String(checkbox.checked));

        // Dispatch change event so existing calendar logic picks it up
        checkbox.dispatchEvent(new Event('change', { bubbles: true }));
      }
    });
  });
</script>

<style>
  .calendar-bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: var(--z-drawer-bg);
    padding: 10px 16px calc(10px + env(safe-area-inset-bottom, 0px));
    background: color-mix(in srgb, var(--bg-body) 90%, transparent);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-top: 1px solid var(--bg-movie-hover);
    display: flex;
    justify-content: center;
  }

  .saved-filter-container {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .saved-filter-label {
    font-size: 12px;
    font-weight: 400;
    text-transform: uppercase;
    color: var(--text-tertiary);
    font-family: 'Barlow Semi Condensed', sans-serif;
    letter-spacing: -0.01em;
  }

  /* Segmented toggle (reuse same styling as CalendarViewToolbar) */
  .segmented-toggle {
    display: inline-flex;
    border: 1px solid var(--bg-movie-hover);
    border-radius: 6px;
    overflow: hidden;
    background: var(--bg-body);
  }

  .seg-btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    font-size: 13px;
    font-family: inherit;
    font-weight: 400;
    color: var(--text-secondary);
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background-color 0.15s ease, color 0.15s ease;
  }

  .seg-btn:not(:last-child) {
    border-right: 1px solid var(--bg-movie-hover);
  }

  .seg-btn:hover {
    background: var(--bg-movie);
    color: var(--text-primary);
  }

  .seg-btn.active {
    background: var(--bg-movie);
    color: var(--btn-color, var(--text-primary));
  }

  .saved-filter-status {
    font-size: 12px;
    color: var(--text-tertiary);
    display: none;
  }

  .saved-filter-status:not(:empty) {
    display: inline;
  }

  @media (max-width: 479px) {
    .saved-filter-container {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }
  }
</style>
