---
/**
 * Sticky filter bar for the calendar page.
 * Contains frequently-used filters: Availability, Saved movies.
 * Stays visible while scrolling (frosted glass, position: sticky).
 */
import CheckboxGroup from '@components/CheckboxGroup.astro';
---

<div class="calendar-filter-bar">
  <div class="filter-bar-row">
    <span class="filter-label">Times</span>
    <!-- Hidden select preserved for existing JS compatibility -->
    <select id="hours-filter-select" name="hours-filter-mode" style="display:none">
      <option value="none">All</option>
      <option value="afterhours">After 5pm + wknds</option>
      <option value="weekends">Weekends</option>
    </select>
    <div class="segmented-toggle" role="radiogroup" aria-label="Showtime availability filter">
      <button class="seg-btn active" data-hours="none" role="radio" aria-checked="true">
        All <span class="hours-count" data-count-for="none"></span>
      </button>
      <button class="seg-btn" data-hours="afterhours" role="radio" aria-checked="false">
        After 5 & Wknds <span class="hours-count" data-count-for="afterhours"></span>
      </button>
      <button class="seg-btn" data-hours="weekends" role="radio" aria-checked="false">
        Weekends <span class="hours-count" data-count-for="weekends"></span>
      </button>
    </div>
  </div>
</div>

<style>
  .calendar-filter-bar {
    position: sticky;
    top: 0;
    z-index: var(--z-drawer-bg);
    padding: 10px 12px;
    margin: 0 -12px;
    background: color-mix(in srgb, var(--bg-body) 85%, transparent);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--bg-movie-hover);
  }

  .filter-bar-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .filter-label {
    font-size: 12px;
    font-weight: 400;
    color: var(--text-tertiary);
    font-family: 'Barlow Semi Condensed', sans-serif;
    text-transform: uppercase;
    letter-spacing: -0.01em;
  }

  .segmented-toggle {
    display: inline-flex;
    border: 1px solid var(--bg-movie-hover);
    border-radius: 6px;
    overflow: hidden;
    background: var(--bg-body);
  }

  .seg-btn {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 5px 10px;
    font-size: 13px;
    font-family: inherit;
    font-weight: 400;
    color: var(--text-secondary);
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background-color 0.15s ease, color 0.15s ease;
  }

  .seg-btn:not(:last-child) {
    border-right: 1px solid var(--bg-movie-hover);
  }

  .seg-btn:hover {
    background: var(--bg-movie);
    color: var(--text-primary);
  }

  .seg-btn.active {
    background: var(--bg-movie);
    color: var(--text-primary);
  }

  .hours-count {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .seg-btn.active .hours-count {
    color: var(--text-secondary);
  }

  @media (max-width: 479px) {
    .filter-bar-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
  }
</style>

<script>
  const hoursSelect = document.getElementById('hours-filter-select') as HTMLSelectElement;
  const hoursButtons = document.querySelectorAll('.calendar-filter-bar .seg-btn[data-hours]');

  hoursButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = (btn as HTMLElement).dataset.hours!;

      // Update button visuals
      hoursButtons.forEach(b => {
        b.classList.toggle('active', b === btn);
        b.setAttribute('aria-checked', String(b === btn));
      });

      // Sync hidden select and dispatch change
      if (hoursSelect) {
        hoursSelect.value = mode;
        hoursSelect.dispatchEvent(new Event('change', { bubbles: true }));
      }
    });
  });

  // Init from restored URL state
  document.addEventListener('url-state-restored', () => {
    if (hoursSelect) {
      const current = hoursSelect.value;
      hoursButtons.forEach(btn => {
        const match = (btn as HTMLElement).dataset.hours === current;
        btn.classList.toggle('active', match);
        btn.setAttribute('aria-checked', String(match));
      });
    }
  });
</script>
